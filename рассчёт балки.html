<html>
<head>
<!--<HTA:APPLICATION ID="oHTA"
APPLICATIONNAME="WMPTour"
BORDER="thin"
BORDERSTYLE="normal"
maximizeButton="no"
minimizeButton="no"
ICON="img/wmptour.ico"
SINGLEINSTANCE="yes"
SYSMENU="yes"
VERSION="1.0"/>-->
<title>Расчёт балки</title>
<script src="propertiesofmaterials.js"></script>
<script>
var fx =[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]; // я не знал как сделать массив по-нормальному. не знаю до сих пор.
var forcesm = [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0];
var n_values = [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0];
var d_values = [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0];
var shape = 3; // форма сечения
var material = 0;
var lb = 0.0; // длина балки
var x = 0; // count of forces
var materials_names_select_text = "";
var p1_text_results = "";

function swap(arr, a, b) { //it need 4 sort
var temp = arr[a];
arr[a] = arr[b];
arr[b] = temp;
}

const Compare = { // it's too
LESS_THAN: -1,
BIGGER_THAN: 1
};

function defaultCompare(a, b) //and it
{
if (a === b) {
return 0;
}
return a < b ? Compare.LESS_THAN : Compare.BIGGER_THAN;
}

function input_forces() // actually, not only forces...
{
material = parseInt(prompt(materials_names_select_text,0));
lb = parseInt(prompt("Длина балки", "5"));
x = parseInt(prompt("Количество сил", "1"));
shape = parseInt(prompt("форма сечения: 1-квадратное, 3-круглое", "1"));
for (var i = 0; i < x; i++) {
fx[i] = parseInt(prompt("Расстояние от заделки до точки приложения силы("+(i+1)+")", "5"));
if (fx[i]>lb)
{
alert("");
break;
}
forcesm[i] = parseInt(prompt("величина силы", "5"));
}
}

function sort_forces(arr, len, compare = defaultCompare) //shitcode
{
for (let i = 0; i < len; i++) {
for (let j = 0; j < len ; j++) { 
if (compare(arr[j], arr[j]) === Compare.BIGGER_THAN) {
swap(arr, j, j + 1);
swap(forcesm, j, j + 1);
}
}
}
return arr;
}

function calc_n() // calc niggas bahahahah
{
  p1_text_results = "1. Определение продольных сил на участках стержня<br>"
  for(var j=x-1; j!=-1; j--)
  {
    n_values[j] = n_values[j+1]+forcesm[j];
    p1_text_results += "N["+(x-j)+"] ="+ n_values[j]+"<br>"
  }
}

function calc_diam()
{
  p1_text_results += "<br> 2. Подбор сечения бруса  равного сопротивления<br>";
  for(var i=0; i<x; i++){
    if(n_values[i]<0)
	{
	  if(shape == 1)
	  {
	    d_values[i]=Math.sqrt((Math.abs(n_values[i])*1000)/sigma_s[material]);
	  }
	  if(shape == 3)
	  {
	    d_values[i]=Math.sqrt((4*Math.abs(n_values[i])*1000)/(3.1415*sigma_s[material]));
	  }
	}
    if(n_values[i]>0){
	  if(shape == 1){
	    d_values[i]=Math.sqrt(Math.abs(n_values[i])*1000/sigma_r[material]);
	  }
	  if(shape == 3){
	    d_values[i]=Math.sqrt(4*Math.abs(n_values[i])*1000/(3.1415*sigma_r[material]));
	  }
	}
	p1_text_results += "d["+(i+1)+"]="+d_values[i]+"<br>";
  }
  p1_text_results += "<br>посмотрю я на тебя, растачивающего вал точно-ровно такого размера =) <br> поэтому будем приведить к нормальным размерам. они так и называются - нормальные размеры.<font color='#888888'>(нормальные, не то что эти психи шизофреники ахахахаххахаха)</font><br>";
  for(var i=0; i<x; i++)
  {  
	var min_p_z_r = 99999;
	var min_p_z_r_id = 0;
	var max_o_z_r = -99999;
	var max_o_z_r_id = 0;
    for(var j=0; (table_of_normal_sizes[j]-d_values[i]) < 0; j++)
	{
	  if((table_of_normal_sizes[j]-d_values[i])>max_o_z_r)
	  {
	    max_o_z_r = table_of_normal_sizes[j]-d_values[i];
		max_o_z_r_id = j;
	  }
	}
	for(var j=max_o_z_r_id; (table_of_normal_sizes[j]-d_values[i]) < table_of_normal_sizes.length; j++)
	{
	  if(((table_of_normal_sizes[j]-d_values[i])<min_p_z_r)&&((table_of_normal_sizes[j]-d_values[i])>0))
	  {
	    min_p_z_r = table_of_normal_sizes[j]-d_values[i];
		min_p_z_r_id = j;
	  }
	}
	p1_text_results += "По таблице нормальных размеров, видно, что близжайшие к числу " +d_values[i]+ " значения это "+table_of_normal_sizes[min_p_z_r_id]+" и "+table_of_normal_sizes[max_o_z_r_id]+"<br> проверяем прочность:";
	if(shape == 1)
	{
	  let test_result2 = (n_values[i]*1000)/(table_of_normal_sizes[max_o_z_r_id]*table_of_normal_sizes[max_o_z_r_id]);
	  if(n_values[i]<0)
	  {
		if( ((test_result2 - sigma_s[material])/sigma_s[material])*100 < 5)
		{
		  p1_text_results += "перенапряжение равно "+  (((test_result2 - sigma_s[material])/sigma_s[material])*100) + " < 5%, а значит и так сойдёт, d=" + table_of_normal_sizes[max_o_z_r_id]+"<br>";
		  d_values[i] = table_of_normal_sizes[max_o_z_r_id];
		}
		else{
		  p1_text_results += "перенапряжение равно "+  (((test_result2 - sigma_s[material])/sigma_s[material])*100) + " > 5%, а значит d=" + table_of_normal_sizes[min_p_z_r_id]+"<br>";
		  d_values[i] = table_of_normal_sizes[min_p_z_r_id];
		}
	  }
	  if(n_values[i]>0)
	  {
		if( ((test_result2 - sigma_r[material])/sigma_r[material])*100 < 5)
		{
		  p1_text_results += "перенапряжение равно "+  (((test_result2 - sigma_r[material])/sigma_r[material])*100) + " < 5%, а значит и так сойдёт, d=" + table_of_normal_sizes[max_o_z_r_id]+"<br>";
		  d_values[i] = table_of_normal_sizes[max_o_z_r_id];
		}
		else{
		  p1_text_results += "перенапряжение равно "+  (((test_result2 - sigma_r[material])/sigma_r[material])*100) + " > 5%, а значит d=" + table_of_normal_sizes[min_p_z_r_id]+"<br>";
		  d_values[i] = table_of_normal_sizes[min_p_z_r_id];
		} 
	  }
	}
	if(shape == 3)
	{
	  let test_result2 = (4000*Math.abs(n_values[i]))/(table_of_normal_sizes[max_o_z_r_id]*table_of_normal_sizes[max_o_z_r_id]*3.14);
	  alert(test_result2 + "= (4000*"+n_values[i]+")/("+(table_of_normal_sizes[max_o_z_r_id]*table_of_normal_sizes[max_o_z_r_id])+"*3.14);");
	  if(n_values[i]<0)
	  {
		if( ((test_result2 - sigma_s[material])/sigma_s[material])*100 < 5)
		{
		  p1_text_results += i+"перенапряжение равно "+  (((test_result2 - sigma_s[material])/sigma_s[material])*100) + " < 5%, а значит и так сойдёт, d=" + table_of_normal_sizes[max_o_z_r_id]+"<br>";
		  d_values[i] = table_of_normal_sizes[max_o_z_r_id];
		}
		else{
		  p1_text_results += i+"перенапряжение равно "+  (((test_result2 - sigma_s[material])/sigma_s[material])*100) + " > 5%, а значит d=" + table_of_normal_sizes[min_p_z_r_id]+"<br>";
		  d_values[i] = table_of_normal_sizes[min_p_z_r_id];
		}
	  }
	  if(n_values[i]>0)
	  {
		if( ((test_result2 - sigma_r[material])/sigma_r[material])*100 < 5)
		{
		  p1_text_results += i+"перенапряжение равно "+  (((test_result2 - sigma_r[material])/sigma_r[material])*100) + " < 5%, а значит и так сойдёт, d=" + table_of_normal_sizes[max_o_z_r_id]+"<br>";
		  d_values[i] = table_of_normal_sizes[max_o_z_r_id];
		}
		else{
		  p1_text_results += i+"перенапряжение равно "+  (((test_result2 - sigma_r[material])/sigma_r[material])*100) + " > 5%, а значит d=" + table_of_normal_sizes[min_p_z_r_id]+"<br>";
		  d_values[i] = table_of_normal_sizes[min_p_z_r_id];
		} 
	  }
	}	
  }
}


function calc_sigma(){}
function calc_dl(){}
function calc_delta(){}
function draw_diam(){}
function draw_sigma(){}
function draw_dl(){}
function draw_delta(){}

function init_materials_names()
{
  materials_names_select_text = "материал балки, отправить цифру:";
  for(var i = 0; i < names_materials.length; i++)
  {
    materials_names_select_text = materials_names_select_text + "\n" + i + " - " +names_materials[i];
  }
}

function alerted() //it all begins here
{
  init_materials_names();
  input_forces(); // input forces
  fx=sort_forces(fx, x); //sorting forces 4 more easier calculating "N"
  calc_n(); //
  console.log(n_values);
  console.log(forcesm);
  calc_diam(); //
  calc_sigma();
  calc_dl();
  calc_delta();
  document.getElementById("p1").innerHTML=p1_text_results;
}

</script>
</head>

<body>
<h1>Расчёт на прочность и жёсткость при растяжении и сжатии</h1>
<h3> ВНИМАНИЕ! для того, чтобы пересчитать результаты, необходимо перезагрузить страницу</h3>
<table border="2" style="border-collapse:collapse;">
<tr>
<th width=300>Эпюры</th>
<th width=500>Данные</th>
</tr> <!-- заголовки чисто чтобы начать работать -->

<tr> <!-- самое интересное -->
<td>
<center>
<canvas height='500' width='280' id='example'>я... х№й знает что ты утворил, чтобы увидеть этот текст, но, пожалуйста, верни всё как было. а то эпюр не будет. тебе ведь нужны эпюры?</canvas>
<!-- вот реально -->
</center>
<script async>
var example = document.getElementById("example");
var ctx = example.getContext('2d');
ctx.shadowOffsetX = 5;
ctx.shadowOffsetY = 5;
ctx.shadowBlur = 5; // это почему-то не работает
ctx.fillStyle = "#00F";
ctx.strokeStyle = "#F00";
ctx.font = 'bold 30px sans-serif';
ctx.strokeText("Тут будут эпюры", 20, 50);
ctx.font = "italic 10pt Arial";
ctx.fillText("но сначала необходимо ввести данные", 20, 100);
// красота, не правда ли?
</script>
</td>
<td>
<button type="submit" onclick="alerted();">начать рассчёты</button>
<p id="p1"></p></td>
</tr>
</table>
<p>Пользуйся на здоровье, но лучше всё-таки сопромат учи, хотя, если ты это читаешь, от пересдачи тебя это не спасёт =)</p>
</body>

</html>